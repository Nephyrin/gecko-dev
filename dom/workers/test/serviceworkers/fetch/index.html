<!--
  Any copyright is dedicated to the Public Domain.
  http://creativecommons.org/publicdomain/zero/1.0/
-->
<!DOCTYPE HTML>
<html>
<head>
  <title>Bug 94048 - test install event.</title>
  <script type="text/javascript" src="/tests/SimpleTest/SimpleTest.js"></script>
  <link rel="stylesheet" type="text/css" href="/tests/SimpleTest/test.css" />
</head>
<body>
<p id="display"></p>
<div id="content" style="display: none"></div>
<pre id="test"></pre>
<script class="testbody" type="text/javascript">

  function my_ok(result, msg) {
    window.opener.postMessage({status: "ok", result: result, message: msg}, "*");
  }

  function fetch(name, onload, onerror) {
    gExpected++;

    onload = onload || function() {
      my_ok(false, "load should not complete successfully");
      finish();
    };
    onerror = onerror || function() {
      my_ok(false, "load should be intercepted successfully");
      finish();
    };

    var x = new XMLHttpRequest();
    x.open('GET', name, true);
    x.onload = function() { onload(x) };
    x.onerror = function() { onerror(x) };
    x.send();
  }

  var gExpected = 0;
  var gEncountered = 0;
  function finish() {
    gEncountered++;
    if (gEncountered == gExpected) {
      window.opener.postMessage({status: "done"}, "*");
    }
  }

  my_ok(navigator.serviceWorker.controller != null, "should be controlled");

  fetch('synthesized.txt', function(xhr) {
    my_ok(xhr.status == 200, "load should be successful");
    my_ok(xhr.responseText == "synthesized response body", "load should have synthesized response");
    finish();
  });

  fetch('ignored.txt', function(xhr) {
    my_ok(xhr.status == 404, "load should be uninterrupted");
    finish();
  });

  fetch('rejected.txt', null, function(xhr) {
    my_ok(xhr.status == 0, "load should not complete");
    finish();
  });

  fetch('nonresponse.txt', null, function(xhr) {
    my_ok(xhr.status == 0, "load should not complete");
    finish();
  });

  fetch('nonresponse2.txt', null, function(xhr) {
    my_ok(xhr.status == 0, "load should not complete");
    finish();
  });

</script>
</pre>
</body>
</html>


